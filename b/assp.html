<html>

<head>
    <!-- for non-UI builds: -->
    <script src="https://ajax.googleapis.com/ajax/libs/shaka-player/3.2.0/shaka-player.compiled.js"></script>
    <!-- or, for UI builds: -->
    <script src="https://ajax.googleapis.com/ajax/libs/shaka-player/3.2.0/shaka-player.ui.js"></script>
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/shaka-player/3.2.0/controls.css">
</head>

<body>
    <center>
        <div data-shaka-player-container style="max-width:40em" data-shaka-player-cast-receiver-id="1BA79154">
            <!-- The data-shaka-player tag will make the UI library use this video element.
            If no video is provided, the UI will automatically make one inside the container div. -->
            <video autoplay data-shaka-player id="video" style="width:100%;height:100%"></video>
        </div>
    </center>
    <script>
        const manifestUri = "https://d3j4fjrwclc3o8.cloudfront.net/CH1/masterCH1.mpd";
        async function init() {
            const video = document.getElementById('video');
            const ui = video['ui'];
            const controls = ui.getControls();
            const player = controls.getPlayer();
            window.player = player;
            window.ui = ui;
            player.configure({
                drm: {
                    "clearKeys": {
                        "b3ccf73a7a664f85ae7411367ffb2fa7": "9687d91b7fd647a88183d0a4cc925f77"
                    }
                }
            });
            player.addEventListener('error', onPlayerErrorEvent);
            controls.addEventListener('error', onUIErrorEvent);
            try {
                await player.load(manifestUri);
                console.log('The video has now been loaded!');
            } catch (error) {
                onPlayerError(error);
            }
            player.getNetworkingEngine().registerRequestFilter(function(type, request) {
                if (type == shaka.net.NetworkingEngine.RequestType.SEGMENT) {
                    request.headers['authorization'] = 'Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJkZXZpY2VUeXBlIjoiUEMiLCJsb2MiOm51bGwsImFwaUtleSI6IjQ3NzU3NSIsInZzdGF0dXMiOnRydWUsImxvZ2luVHlwZSI6IlNvY2lhbExvZ2luSUQiLCJpc3MiOiJldiIsIm1vZGVsTm8iOiIxMDAuMC40ODk2LjEyNyIsImNwIjoiQVNUUk8iLCJkZXZpY2VOYW1lIjoiQ2hyb21lIiwic2lkIjoiMjEwNjE4MTMwNjU4NzcyNDU3MTM4MjI1NDU3MTM4MjI1Iiwic2VyaWFsTm8iOiJXRUItMmQ2M2Q0MTktNGQ1YS0yYjc5LWZlMTYtOTE2MTY0NmY4YTIwIiwidWlkIjoiNTc1OGY2YTItNjc5OC00Y2VkLTk4ZjEtNTMwMmRiZWU3ZGRhIiwiYXVkIjoiQVNUUk9TT1RUIiwibmJmIjoxNjU1NjcwMDAzLCJleHAiOjE2NTU5MjkyMDgsImlhdCI6MTY1NTY3MDAwOCwianRpIjoiSlRydC1nczVTLXl1bnAtM2hwOS1mQXJZLVpRSk4tUVUiLCJjaWQiOiI0NTcxNjExNTMifQ.TDlceos_SVXWYhtWAYLNxZHV_KmuCCrn1GsfmJ_NzzNwe2bf5_GkwLbaHSigbjD3f_j7jjtaGrXFn403HXKkWzgw_S9K78lrmTroF2uZ20rIZ0z_qSXqbvUsF6ZQSwrvmYhDXaiLzBvvOi6LJeEHSPTU2s0_DW0CrQ45nDuF7tjoFPPMRjCmlxP_MMXyMsgy1ok_YzWRPFJ00wqRbaDMwrAUSlcnvR8WDoUbZ1nyVkXo-d_9djRSEAeNaD922bMe5wqlOKRiByuRda_I9feI218yf7UhmcAcP0uTBWHFzOjwmcDdmSoTSBsSPuBWgVBzQk6PhKvrGbKN7ENM8SJ-FA';
                }
            });
        }

        function onPlayerErrorEvent(errorEvent) {
            onPlayerError(event.detail);
        }

        function onPlayerError(error) {
            console.error('Error code', error.code, 'object', error);
        }

        function onUIErrorEvent(errorEvent) {
            onPlayerError(event.detail);
        }

        function initFailed(errorEvent) {
            console.error('Unable to load the UI library!');
        }
        document.addEventListener('shaka-ui-loaded', init);
        document.addEventListener('shaka-ui-load-failed', initFailed);
    </script>
</body>

</html>
